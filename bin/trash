#!/usr/bin/env bash
# --------------------------------------------------------------------------
# Safe alternative to the rm command. This script transfers deleted files
# and directories to the trash directory, $HOME/.trash/.
#
# Author: Darren Mulholland <darren@mulholland.xyz>
# License: Public Domain
# --------------------------------------------------------------------------

# The ~/.trash directory exists on OSX. We may need to create it on other
# systems.
if [[ ! -e "$HOME/.trash" ]]; then
    mkdir "$HOME/.trash"
fi

# Move all our arguments to the trash directory.
for arg in "$@"; do
    if [[ "$arg" == "." || "$arg" == ".." ]]; then
        continue
    fi

    if [[ ! -e "$arg" ]]; then
        echo "Error: '$arg' does not exist."
        continue
    fi

    base=$(basename "$arg")
    while [[ -e "$HOME/.trash/$base" ]]; do
        base="$base.$(date "+%y-%m-%d_%H-%M-%S")"
    done

    mv "$arg" "$HOME/.trash/$base"
done
